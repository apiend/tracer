!function(){"use strict";var e=function(){return(e=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};var t={reportUrl:"http://localhost:7002",reportUrlMultiple:"",maxCacheLength:20,isPost:!1,token:"",appVersion:"1.0.0",environment:"prod",outtime:300,enableSPA:!0,autoSendPv:!0,isPage:!0,isAjax:!1,isResource:!1,isError:!0,isRecord:!1,isCountStayTime:!0,isBehavior:!1,ignore:{ignoreErrors:[],ignoreUrls:[],ignorePvs:["404"],ignoreResources:[],ignoreApis:["/api/v1/report/web","livereload.js?snipver=1","/sockjs-node/info"],ignoreBehaviorEles:[]},behavior:{console:["debug","error"],click:!0},maxLength:100,Vue:"",user:{},offlineTime:6e5,sendMill:3e4};function n(n){var o=e(e({},t.ignore),n.ignore);t=e(e(e({},t),n),{ignore:o})}function o(e){return e&&t[e]?t[e]:{}}var r=function(){};function i(){for(var e,t,n=20,o=new Array(n),r=Date.now().toString(36).split("");n-- >0;)t=(e=36*Math.random()|0).toString(36),o[n]=e%3?t:t.toUpperCase();for(var i=0;i<8;i++)o.splice(3*i+2,0,r[i]);return o.join("")}function a(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t.join("&")}function s(e,t){var n=0,o=e.length;if(function(e,t){var n=Object.prototype.toString.call(e).substring(8).replace("]","");return t?n===t:n}(e,"Array"))for(;n<o&&!1!==t.call(e[n],e[n],n);n++);else for(var r in e)if(!1===t.call(e[r],e[r],r))break;return e}var c=function(e,t,n){window.addEventListener?window.addEventListener(e,function o(r){n&&window.removeEventListener(e,o,!0),t.call(this,r)},!0):window.attachEvent&&window.attachEvent("on"+e,function o(r){n&&window.detachEvent("on"+e,o),t.call(this,r)})},d=function(e,t){return t?(window.removeEventListener?window.removeEventListener(e,t):window.detachEvent&&window.detachEvent(e,t),this):this},u=function(e){return(e?l(e.replace(/^#\/?/,"")):"")||"[index]"},l=function(e){return e&&"string"==typeof e?e.replace(/^(https?:)?\/\//,"").replace(/\?.*$/,""):""},p=function(e){return function(){return e+"() { [native code] }"}},f=function(){var e="object"==typeof console?console.warn:r;try{var t={warn:e};t.warn.call(t)}catch(e){return r}return e}(),h=function(e,t){var n;window.CustomEvent?n=new CustomEvent(e,{detail:t}):((n=window.document.createEvent("HTMLEvents")).initEvent(e,!1,!0),n.detail=t),window.dispatchEvent(n)},v=function(e){var t=e.split("::");return t.length>1?{group:t[0],key:t[1]}:{group:"default_group",key:t[0]}},g=function(e,t){return e.reduce(function(e,n,o){return t(n,o)?o:e},-1)},m=function(){return navigator.userAgent.indexOf("Edge")>-1},w=self!=top,y=function(){var e=new WeakSet;return function(t,n){if("object"==typeof n&&null!==n){if(e.has(n))return;e.add(n)}return n}},b=localStorage.getItem("bombay-cache")?JSON.parse(localStorage.getItem("bombay-cache")):[],L={lastTime:Date.now(),page:"",sid:"",sBegin:Date.now(),_health:{errcount:0,apisucc:0,apifail:0},circle:!1,reportCache:b,cssInserted:!1};function E(e,t){"error"===e&&L._health.errcount++,"api"===e&&t&&L._health.apisucc++,"api"!==e||t||L._health.apifail++}var S="2.1.3";function C(){var e,n,o=function(){var e,t=navigator.userAgent,n={},o=t.match(/MicroMessenger.*?(?= )/);o&&o.length>0&&(n.wechat=o[0]);(t.includes("iPhone")||t.includes("iPad"))&&(t.includes("iPad")?n.deviceModel="iPad":n.deviceModel="iPhone",(o=t.match(/iPhone OS .*?(?= )/))&&o.length>0&&(n.deviceOs=o[0]),e="ios");t.includes("Android")&&((o=t.match(/Android.*; ?(.*(?= Build))/))&&o.length>1&&(n.deviceModel=o[1]),(o=t.match(/Android.*?(?=;)/))&&o.length>0&&(n.deviceOs=o[0]),e="Android");e||(n.deviceModel="pc",n.deviceOs="pc",n.wechat="other");return n}(),r=o.deviceModel+"|"+o.deviceOs+"|"+o.wechat,i=navigator.connection;return{t:"",page:R(),hash:location.hash,v:""+S,token:t.token,e:t.environment,begin:(new Date).getTime(),uid:T(),sid:L.sid,sr:screen.width+"x"+screen.height,vp:(e=document.documentElement.clientWidth||document.body.clientWidth,n=document.documentElement.clientHeight||document.body.clientHeight,e+"x"+n),ct:i?i.effectiveType:"",device:r,ul:A(),o:P(encodeURIComponent(location.href)),user:JSON.stringify(t.user)}}function R(){return L.page?L.page:location.pathname.toLowerCase()}function T(){var e=localStorage.getItem("tracer_uid")||"";return e||(e=i(),localStorage.setItem("tracer_uid",e)),e}function A(){var e=navigator.language||navigator.userLanguage;return e=e.substr(0,2)}function P(e){return btoa(encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,function(e,t){return String.fromCharCode(parseInt(t,16))}))}function j(e){return Array.isArray(e)?x(e):"res"===e.t?x(e):"error"===e.t?x(e):"behavior"===e.t?x(e):"health"===e.t&&window&&window.navigator&&"function"==typeof window.navigator.sendBeacon?function(e){"object"==typeof e&&(e=a(e)),e=t.reportUrl+"?"+e,window&&window.navigator&&"function"==typeof window.navigator.sendBeacon?window.navigator.sendBeacon(e):f("[arms] navigator.sendBeacon not surported")}(e):x(e),this}function x(e){var n;if(Array.isArray(e))k(t.reportUrlMultiple,{behaviorList:e});else if(t.isPost){var o=e[e.t];delete e[e.t],k(t.reportUrl+"?"+a(e),((n={})[e.t]=o,n))}else(new Image).src=t.reportUrl+"?"+a(e)}function k(e,t){var n=window.__oXMLHttpRequest_||window.XMLHttpRequest;if("function"==typeof n)try{var o=new n;o.open("POST",e,!0),o.setRequestHeader("Content-Type","text/plain"),o.send(JSON.stringify(t))}catch(e){f("[tracer.js] Failed to log, POST请求失败")}else f("[tracer.js] Failed to log, 浏览器不支持XMLHttpRequest")}var O="bombayjs-circle-active",_="bombayjs-circle-css";var N=function(e){var t,n,o,r,i,a=[];if(!e||!e.tagName)return"";if(a.push(e.tagName.toLowerCase()),e.id&&a.push("#".concat(e.id)),(t=e.className)&&"[object String]"===Object.prototype.toString.call(t))for(n=t.split(/\s+/),i=0;i<n.length;i++)n[i].indexOf("active")<0&&a.push(".".concat(n[i]));var s=["type","name","title","alt"];for(i=0;i<s.length;i++)o=s[i],(r=e.getAttribute(o))&&a.push("[".concat(o,'="').concat(r,'"]'));return a.join("")},I=function(e){if(!e||1!==e.nodeType)return"";var t=[],n=0,o="";e.innerText&&t.push("("+e.innerText.substr(0,50)+")");for(var r=e||null;r&&n++<5&&"html"!==(o=N(r));)t.push(o),r=r.parentNode;return t.reverse().join(" > ")};function M(n){if(L.circle){var o=n.target.className.split(/\s+/),r=I(n.target);return r=1===o.length||2===o.length&&""===o[0]?r.replace(/\.\.bombayjs-circle-active/,""):r.replace(/\.bombayjs-circle-active/,""),window.parent.postMessage({t:"setElmPath",path:r,page:L.page},"*"),void n.stopPropagation()}var i;try{i=n.target}catch(e){i="<unknown>"}if("INPUT"!==i.nodeName&&"TEXTAREA"!==i.nodeName&&0!==i.length){var a={type:"ui.click",data:{path:I(i),pageX:n.pageX,pageY:n.pageY,message:""}},s=t.ignore.ignoreBehaviorEles.some(function(e){return a.data.path.includes(e)});if(!a.data.path||s)return;var c=C(),d=e(e({},c),{t:"behavior",behavior:a});if(t.reportUrlMultiple){if(L.reportCache.push(d),localStorage.setItem("bombay-cache",JSON.stringify(L.reportCache)),L.reportCache.length>=t.maxCacheLength)j(JSON.parse(JSON.stringify(L.reportCache))),L.reportCache=[],localStorage.removeItem("bombay-cache")}else j(d)}}function U(n){var o;try{o=n.target}catch(e){o="<unknown>"}if("INPUT"===o.nodeName||"TEXTAREA"===o.nodeName){var r={type:"ui.blur",data:{path:I(o),pageX:n.pageX,pageY:n.pageY,message:o.value}},i=t.ignore.ignoreBehaviorEles.some(function(e){return r.data.path.includes(e)});if(r.data.path&&r.data.message&&!i){var a=C();j(e(e({},a),{t:"behavior",behavior:r}))}}}var B=["","fetchStart","domainLookupStart","domainLookupEnd","connectStart","connectEnd","requestStart","responseStart","responseEnd","","domInteractive","","domContentLoadedEventEnd","","loadEventStart","","msFirstPaint","secureConnectionStart"];function D(e){var n=t.enableSPA?u(location.hash.toLowerCase()):location.pathname.toLowerCase();n&&X(n,!1)}function H(e){var n=t.enableSPA?u(e.detail.toLowerCase()):e.detail.toLowerCase();n&&X(n,!1)}function X(n,o){!o&&L.page===n&&L.sBegin>Date.now()-100||(!o&&J(),w&&window.parent.postMessage({t:"setPage",href:location.href,page:n},"*"),function(e){L.page=e}(n),L.sid=i(),L.sBegin=Date.now(),function(){if(t.autoSendPv){var n=C();t.ignore.ignorePvs.includes(n.page)||j(e(e({},n),{t:"pv",dt:document.title,dl:encodeURIComponent(location.href),dr:encodeURIComponent(document.referrer),dpr:window.devicePixelRatio,de:document.charset}))}}())}function J(){var t=L._health.errcount?0:1,n=C(),o=e(e(e({},n),L._health),{t:"health",healthy:t,stay:Date.now()-L.sBegin});L._health={errcount:0,apisucc:0,apifail:0},j(o)}function q(n){if(!t.ignore.ignoreErrors.includes(n.type)){switch(n.type){case"error":n instanceof ErrorEvent?function(t){var n=C(),o=t.name||"CustomError",r=t.message||"",i=t.error.stack||"";j(e(e({},n),{t:"error",st:"caughterror",cate:o,msg:P(r),detail:P(i),file:P(t.filename)||"",line:t.lineno||"",col:t.colno||""}))}(n):function(n){var o=C(),r=n.target;if(t.ignore.ignoreResources.some(function(e){return r.src.includes(e)}))return;j(e(e({},o),{t:"error",st:"resource",msg:encodeURIComponent(r.outerHTML),file:P(encodeURIComponent(r.src)),stack:r.localName.toUpperCase()}))}(n);break;case"unhandledrejection":!function(t){var n=C();j(e(e({},n),{t:"error",st:"promise",msg:P(t.reason)}))}(n)}E("error")}}function F(){var t=window.performance;if(!t||"object"!=typeof t||"function"!=typeof t.getEntriesByType)return null;var n=C(),r=e(e({},n),{dom:0,load:0,t:"res",res:[]}),i=t.timing||{},a=t.getEntriesByType("resource")||[];if("function"==typeof window.PerformanceNavigationTiming){var c=t.getEntriesByType("navigation")[0];c&&(i=c)}if(s({dom:[10,8],load:[14,1]},function(e,t){var n=i[B[e[1]]],o=i[B[e[0]]];if(void 0!==n&&void 0!==o){var a=Math.round(o-n);a>=0&&a<36e5&&(r[t]=a)}}),a=a.filter(function(e){return!(g(o("ignore").ignoreApis,function(t){return e.name.indexOf(t)>-1})>-1)}),m()){var d=[];s(a,function(e){d.push({connectEnd:e.connectEnd,connectStart:e.connectStart,domainLookupEnd:e.connectStart,domainLookupStart:e.domainLookupStart,duration:e.duration,entryType:e.entryType,fetchStart:e.fetchStart,initiatorType:e.initiatorType,name:e.name,redirectEnd:e.redirectEnd,redirectStart:e.redirectStart,responseEnd:e.responseEnd,responseStart:e.responseStart,startTime:e.startTime})}),a=d}r.res=a,j(r)}function V(t,n,r,i,a,s){if(t){E("api",n);var c=P(a),d=encodeURIComponent(t),u=C(),l=e(e({},u),{t:"api",url:d,success:n,time:r,code:i,msg:c});g(o("ignore").ignoreApis,function(e){return d.indexOf(e)>-1})>-1||j(l)}else f("[retcode] api is null")}function Y(e){var t=document.getElementsByClassName(O);if(t.length>0)for(var n=0;n<t.length;n++)t[n].className=t[n].className.replace(/ bombayjs-circle-active/g,"");e.target.className+=" "+O}function W(){!function(){var e="."+O+"{border: #ff0000 2px solid;}",t=document.createElement("style");t.type="text/css",t.id=_;try{t.appendChild(document.createTextNode(e))}catch(n){t.styleSheet.cssText=e}document.getElementsByTagName("head")[0].appendChild(t)}(),L.cssInserted=!0,L.circle=!0,c("mouseover",Y)}function $(){var e;(e=document.getElementById(_)).parentNode.removeChild(e),L.cssInserted=!1,L.circle=!1,d("mouseover",Y)}function z(e){e.data&&e.data.t&&("setCircle"===e.data.t?Boolean(e.data.v)?W():$():"back"===e.data.t?window.history.back():"forward"===e.data.t&&window.history.forward())}function G(){var n=t.sendMill,o=Date.now()-L.lastTime;if(o>t.offlineTime)L.lastTime=Date.now();else if(o>n){L.lastTime=Date.now();var r=C();j(e(e({},r),{t:"duration",duration_ms:o}))}}function K(e){var n=history[e];"function"==typeof n&&(history[e]=function(o,r,i){!window.__bb_onpopstate_&&(window.__bb_onpopstate_=window.onpopstate,window.addEventListener("popstate",function(){var e=t.enableSPA?u(location.hash.toLowerCase()):location.pathname.toLowerCase();X(e,!1)}));var a=1===arguments.length?[arguments[0]]:Array.apply(null,arguments),s=location.href,c=n.apply(history,a);if(!i||"string"!=typeof i)return c;if(i===s)return c;try{var d=s.split("#"),p=i.split("#"),v=l(d[0]),g=l(p[0]),m=d[1]&&d[1].replace(/^\/?(.*)/,"$1"),w=p[1]&&p[1].replace(/^\/?(.*)/,"$1");v!==g?h("historystatechanged",g):m!==w&&h("historystatechanged",w)}catch(t){f("[retcode] error in "+e+": "+t)}return c},history[e].toString=p(e))}function Q(){!function(){if("function"==typeof window.fetch){var e=window.fetch;window.__oFetch_=e,window.fetch=function(n,o){var r=1===arguments.length?[arguments[0]]:Array.apply(null,arguments),i=Date.now(),a=(n&&"string"!=typeof n?n.url:n)||"",s=l(a);return s?e.apply(window,r).then(function(e){var n=e.clone(),o=n.headers;if(o&&"function"==typeof o.get){var r=o.get("content-type");if(r&&!/(text)|(json)/.test(r))return e}var a=Date.now()-i;return n.text().then(function(e){n.ok?V(s,!0,a,status,e.substr(0,t.maxLength)||""):V(s,!1,a,status,e.substr(0,t.maxLength)||"")}),e}):e.apply(window,r)}}}(),function(){if("function"==typeof window.XMLHttpRequest){var e=0,n="",o=window.XMLHttpRequest;window.__oXMLHttpRequest_=o,window.XMLHttpRequest=function(r){var i=new o(r);if(!i.addEventListener)return i;var a=i.open,s=i.send;return i.open=function(e,t){var o=1===arguments.length?[arguments[0]]:Array.apply(null,arguments);n=l(t=t),a.apply(i,o)},i.send=function(){e=Date.now();var t=1===arguments.length?[arguments[0]]:Array.apply(null,arguments);s.apply(i,t)},i.onreadystatechange=function(){if(n&&4===i.readyState){var o=Date.now()-e;if(i.status>=200&&i.status<=299){var r=i.status||200;if("function"==typeof i.getResponseHeader){var a=i.getResponseHeader("Content-Type");if(a&&!/(text)|(json)/.test(a))return}V(n,!0,o,r,i.responseText.substr(0,t.maxLength)||"")}else{var r=i.status||"FAILED";V(n,!1,o,r,i.responseText.substr(0,t.maxLength)||"")}}},i}}}()}(function(){function o(e,t){this.init(e)}o.prototype.init=function(e){var o=e.Vue,r=function(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(o=Object.getOwnPropertySymbols(e);r<o.length;r++)t.indexOf(o[r])<0&&(n[o[r]]=e[o[r]])}return n}(e,["Vue"]);if(r&&!r.token)throw Error("请输入一个token");o&&this.addListenVueError(o),n(r),X(t.enableSPA?u(location.hash.toLowerCase()):location.pathname.toLowerCase(),!0),t.isPage&&this.sendPerf(),t.enableSPA&&this.addListenRouterChange(),t.isError&&this.addListenJs(),t.isAjax&&this.addListenAjax(),t.isRecord&&this.addRrweb(),t.isBehavior&&this.addListenBehavior(),t.isResource&&this.sendResource(),window.__bb=this,this.addListenUnload(),c("message",z),L.circle&&W()},o.prototype.handleCustomizeReport=function(n){if(!t.token)throw Error("请输入一个合法token");!function(t){if(!t.t)throw Error("行为类型不能为空");var n=C();j(e(e({},n),t))}(n)},o.prototype.setUserInfo=function(e){n({user:e})},o.prototype.sendPerf=function(){!function(){var t=window.performance;if(t&&"object"==typeof t)var n={dns:0,tcp:0,ssl:0,ttfb:0,trans:0,dom:0,res:0,firstbyte:0,fpt:0,tti:0,ready:0,load:0},o=t.timing||{},r=Date.now(),i=1,a=setInterval(function(){if(o.loadEventEnd){if(clearInterval(a),"function"==typeof window.PerformanceNavigationTiming){var c=t.getEntriesByType("navigation")[0];c&&(o=c,i=2)}s({dns:[3,2],tcp:[5,4],ssl:[5,17],ttfb:[7,6],trans:[8,7],dom:[10,8],res:[14,12],firstbyte:[7,2],fpt:[8,1],tti:[10,1],ready:[12,1],load:[14,1]},function(e,t){var r=o[B[e[1]]],a=o[B[e[0]]],s=Math.round(a-r);(2===i||void 0!==r&&void 0!==a)&&("dom"===t&&(s=Math.round(a-r)),s>=0&&s<36e5&&(n[t]=s))});var d=window.navigator.connection||window.navigator.mozConnection||window.navigator.webkitConnection,u=t.navigation||{type:void 0};n.ct=d?d.effectiveType||d.type:"";var l=d&&(d.downlink||d.downlinkMax||d.bandwidth)||null;if((l=l>999?999:l)&&(n.bandwidth=l),n.navtype=1===u.type?"Reload":"Other",1===i&&o[B[16]]>0&&o[B[1]]>0){var p=o[B[16]]-o[B[1]];p>=0&&p<36e5&&(n.fpt=p)}1===i&&o[B[1]]>0?n.begin=o[B[1]]:2===i&&n.load>0?n.begin=r-n.load:n.begin=r;var f=C();j(e(e(e(e({},f),{t:"perf"}),n),o))}},50)}()},o.prototype.sendResource=function(){"complete"===window.document.readyState?F():this.addListenResource()},o.prototype.addListenResource=function(){c("load",F)},o.prototype.addListenBehavior=function(){!function(){if(window&&window.console)for(var n=t.behavior.console,o=0;n.length;o++){var r=n[o],i=window.console[r];if(!window.console[r])return;!function(t,n){window.console[t]=function(){var o,r,i=Array.prototype.slice.apply(arguments),a={type:"console",data:{level:t,message:JSON.stringify(i,y())}};o=a,r=C(),j(e(e({},r),{t:"behavior",behavior:o})),n&&n.apply(null,i)}}(r,i)}}(),t.behavior.click&&this.addListenClick()},o.prototype.addListenClick=function(){c("click",M),c("blur",U),t.isCountStayTime&&(c("click",G),c("blur",G))},o.prototype.addListenRouterChange=function(){K("pushState"),K("replaceState"),c("hashchange",D),c("historystatechanged",H)},o.prototype.addListenVueError=function(t){if(t&&t.config){t.config.errorHandler;t.config.errorHandler=function(t,n,o){console.error(t),function(t,n,o){var r=C();j(e(e({},r),{t:"error",st:"vue_error",msg:P(t),file:"",detail:JSON.stringify(o,y())}))}(t,0,o)}}},o.prototype.addListenJs=function(){c("error",q),c("unhandledrejection",q)},o.prototype.addListenAjax=function(){Q()},o.prototype.addListenUnload=function(){c("beforeunload",J),this.destroy()},o.prototype.addRrweb=function(){},o.prototype.removeListenRouterChange=function(){d("hashchange",D),d("historystatechanged",H)},o.prototype.removeListenJs=function(){d("error",q),d("unhandledrejection",q)},o.prototype.removeListenResource=function(){d("beforeunload",J)},o.prototype.removeListenAjax=function(){},o.prototype.removeListenUnload=function(){d("load",F)},o.prototype.removeRrweb=function(){},o.prototype.sum=function(t,n){!function(t,n){void 0===n&&(n=1);var o=C(),r=v(t);j(e(e(e({},o),r),{t:"sum",val:n}))}(t,n)},o.prototype.avg=function(t,n){!function(t,n){void 0===n&&(n=1);var o=C(),r=v(t);j(e(e(e({},o),r),{t:"avg",val:n}))}(t,n)},o.prototype.msg=function(n){!function(n){var o=C(),r=v(n);j(e(e({},o),{t:"msg",group:r.group,msg:P(r.key.substr(0,t.maxLength))}))}(n)},o.prototype.api=function(e,t,n,o,r){V(e,t,n,o,r)},o.prototype.destroy=function(){t.enableSPA&&this.removeListenRouterChange(),t.isError&&this.removeListenJs(),t.isAjax&&this.removeListenAjax(),t.isRecord&&this.removeRrweb(),t.isResource&&this.removeListenResource(),this.removeListenResource()}})()}();
